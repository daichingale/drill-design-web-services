# ドリルデザインWebサービス - 必要な機能一覧

## 📋 目次
1. [既存機能](#既存機能)
2. [優先度：高](#優先度高)
3. [優先度：中](#優先度中)
4. [優先度：低](#優先度低)
5. [将来の拡張機能](#将来の拡張機能)

---

## 既存機能

### ✅ 実装済み
- **メンバー管理**
  - メンバーの追加・削除
  - 名前・楽器パート・色の設定
  - メンバー一覧表示

- **ドリルエディタ**
  - フィールド上でのドット配置・移動
  - 複数選択（矩形選択対応）
  - スナップモード（ホール/ハーフ/自由）
  - 矢印キーでの微調整
  - ズーム機能（0.5x〜2.5x）
  - ベジェアーク整列
  - 直線整列
  - セット（Set）管理
  - セットごとのノート機能
  - セットの開始カウント設定

- **再生機能**
  - タイムライン表示
  - カウント再生（指定範囲）
  - スクラブ（ドラッグでカウント移動）
  - 3Dプレビュー

- **UI/UX**
  - ダークテーマ
  - レスポンシブデザイン
  - キーボードショートカット（Undo/Redo、Ctrl+A）

---

## 優先度：高

### 1. データ保存・読み込み機能
**現状**: データはメモリ上のみ。リロードで消失。

**必要な機能**:
- [ ] **ローカルストレージ保存**
  - 自動保存（定期的なバックアップ）
  - 手動保存ボタン
  - 保存データの確認・管理

- [x] **JSON エクスポート/インポート**
  - ドリルデータのJSON形式でのエクスポート
  - JSONファイルからの読み込み
  - バージョン管理（データ形式の互換性）

- [x] **YAML エクスポート/インポート**
  - ドリルデータのYAML形式でのエクスポート（人間が読みやすい形式）
  - YAMLファイルからの読み込み
  - コメント付きでエクスポート可能
  - JSONと同等の機能を持ちながら、より柔軟な編集が可能

- [ ] **データベース連携**
  - Prismaスキーマの完成（Drill、Set、Memberテーブル）
  - API エンドポイント（保存・読み込み・一覧取得）
  - ユーザー認証（将来的に）
  - ドリル一覧表示ページ

### 2. Undo/Redo の完全実装
**現状**: 履歴は記録されているが、復元機能が未実装。

**必要な機能**:
- [ ] `useDrillSets` に `restoreState` 関数を実装
- [ ] Undo/Redo実行時に状態を完全復元
- [ ] 履歴の上限設定（メモリ対策）
- [ ] 履歴の可視化（オプション）

### 3. セット間のコピー/ペースト
**現状**: セット追加時に現在のセットをコピーする機能はあるが、任意のセット間でのコピー/ペーストは未実装。

**必要な機能**:
- [ ] セット全体のコピー
- [ ] 選択メンバーのみコピー
- [ ] 複数セットへの一括ペースト
- [ ] クリップボード管理（複数のコピーを保持）

### 4. セットの削除・並び替え
**現状**: セットの追加のみ可能。

**必要な機能**:
- [ ] セット削除機能
- [ ] セットの並び替え（ドラッグ&ドロップ）
- [ ] セット名の編集
- [ ] セットの複製

### 5. 設定ページの機能実装
**現状**: UIのみ。実際の設定変更は未実装。

**必要な機能**:
- [ ] フィールドサイズの変更（リアルタイム反映）
- [ ] 表示単位の切り替え（メートル/ヤード/ステップ）
- [ ] グリッド表示のON/OFF
- [ ] グリッド間隔の調整
- [ ] BPM設定（再生速度に反映）

---

## 優先度：中

### 6. 高度な整列機能
**現状**: 直線整列とベジェアークのみ。

**必要な機能**:
- [ ] **円形整列**
  - 中心点と半径の指定
  - 開始角度・終了角度の設定

- [ ] **グリッド整列**
  - 行数・列数の指定
  - 間隔の調整

- [ ] **等間隔整列**
  - 選択メンバー間の距離を均等化

- [ ] **対称整列**
  - X軸/Y軸/中心点での対称配置

### 7. パス（移動経路）の可視化
**現状**: セット間の移動は再生時のみ表示。

**必要な機能**:
- [ ] 選択メンバーの移動経路を表示
- [ ] パスの編集（中間点の追加・削除）
- [ ] パスのスムージング設定
- [ ] 衝突検知の可視化

### 8. 検索・フィルタ機能
**必要な機能**:
- [ ] メンバー名での検索
- [ ] 楽器パートでのフィルタ
- [ ] セット名での検索
- [ ] カウント範囲でのフィルタ

### 9. エクスポート機能
**必要な機能**:
- [ ] **画像エクスポート**
  - PNG/JPEG形式
  - 解像度設定
  - 背景色の選択

- [ ] **PDFエクスポート**
  - セットごとのページ分割
  - グリッド線の表示/非表示
  - メンバー情報の表示

- [ ] **動画エクスポート**
  - 再生アニメーションの録画
  - フレームレート設定

### 10. パフォーマンス最適化
**必要な機能**:
- [ ] 大量メンバー時の描画最適化
- [ ] 仮想スクロール（メンバーリスト）
- [ ] メモ化の強化
- [ ] レンダリングの遅延読み込み

---

## 優先度：低

### 11. コメント・注釈機能
**必要な機能**:
- [ ] フィールド上へのテキスト注釈
- [ ] マーカー・矢印の追加
- [ ] セットごとの詳細メモ
- [ ] カウントごとのコメント

### 12. テンプレート機能
**必要な機能**:
- [ ] よく使うフォーメーションのテンプレート
- [ ] テンプレートの保存・読み込み
- [ ] テンプレートライブラリ

### 13. 統計・分析機能
**必要な機能**:
- [ ] 移動距離の計算
- [ ] 移動速度の分析
- [ ] フォーメーションの複雑度スコア
- [ ] 衝突リスクの可視化

### 14. マルチユーザー対応（将来）
**必要な機能**:
- [ ] リアルタイム共同編集
- [ ] 変更履歴の追跡
- [ ] コメント機能
- [ ] 権限管理

### 15. モバイル対応
**必要な機能**:
- [ ] タッチ操作の最適化
- [ ] レスポンシブレイアウトの改善
- [ ] モバイル用の簡易ビュー

---

## 将来の拡張機能

### 16. 音楽同期
- [ ] 音楽ファイルの読み込み
- [ ] 音楽に合わせたカウント表示
- [ ] 音楽再生とドリルの同期

### 17. 3D編集機能
- [ ] 3D空間での編集
- [ ] 高さ（Z軸）の設定
- [ ] 3Dプレビューの改善

### 18. AI支援機能
- [ ] 自動パス生成
- [ ] 衝突回避の提案
- [ ] フォーメーションの最適化提案

### 19. プラグインシステム
- [ ] カスタム整列アルゴリズム
- [ ] 外部ツールとの連携
- [ ] 拡張機能のAPI

### 20. 多言語対応
- [ ] 英語・日本語の切り替え
- [ ] その他の言語への拡張

---

## 実装の優先順位（推奨）

### Phase 1: データ永続化（最優先）
1. ローカルストレージ保存
2. JSON エクスポート/インポート
3. Undo/Redo の完全実装

### Phase 2: 基本機能の完成
4. セット間のコピー/ペースト
5. セットの削除・並び替え
6. 設定ページの機能実装

### Phase 3: 高度な機能
7. 高度な整列機能
8. パスの可視化
9. エクスポート機能

### Phase 4: ユーザビリティ向上
10. 検索・フィルタ機能
11. コメント・注釈機能
12. テンプレート機能

---

## 技術的な考慮事項

### データ構造
- `Drill` 型の拡張（メタデータ、バージョン情報）
- セット間の関係性の管理
- 履歴データの圧縮

### パフォーマンス
- 大量データ時の処理最適化
- 描画の最適化（Canvas/WebGL）
- メモリ管理

### セキュリティ
- データの検証
- XSS対策
- ファイルアップロードの安全性

### アクセシビリティ
- キーボード操作の完全対応
- スクリーンリーダー対応
- 色覚対応

---

## 参考資料

- Pyware（既存のドリルデザインツール）
- マーチングバンドの標準的なワークフロー
- ユーザーフィードバック（今後収集）


