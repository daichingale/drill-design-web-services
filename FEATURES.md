# ドリルデザインWebサービス - 必要な機能一覧

## 📋 目次
1. [既存機能](#既存機能)
2. [優先度：高](#優先度高)
3. [優先度：中](#優先度中)
4. [優先度：低](#優先度低)
5. [将来の拡張機能](#将来の拡張機能)

---

## 既存機能

### ✅ 実装済み
- **メンバー管理**
  - メンバーの追加・削除
  - 名前・楽器パート・色の設定
  - メンバー一覧表示
  - **単一画面でのインタラクティブ管理**（タブ切り替え）
  - **一括追加機能**（パート・人数・開始番号を指定して複数メンバーを一度に追加）
  - JSON形式でのエクスポート/インポート

- **ドリルエディタ**
  - フィールド上でのドット配置・移動
  - 複数選択（矩形選択対応）
  - スナップモード（ホール/ハーフ/自由）
  - 矢印キーでの微調整
  - ズーム機能（0.5x〜2.5x）
  - ベジェアーク整列
  - 直線整列
  - セット（Set）管理
  - セットごとのノート機能
  - セットの開始カウント設定

- **再生機能**
  - タイムライン表示
  - カウント再生（指定範囲）
  - スクラブ（ドラッグでカウント移動）
  - 3Dプレビュー

- **UI/UX**
  - ダークテーマ
  - レスポンシブデザイン
  - キーボードショートカット（Undo/Redo、Ctrl+A）
  - スクロールバーのカスタマイズ（Discord風）
  - コマンドパレット（Ctrl+K）

---

## 優先度：高

### 1. データ保存・読み込み機能
**現状**: データはメモリ上のみ。リロードで消失。

**必要な機能**:
- [x] **ローカルストレージ保存**
  - [x] 自動保存（定期的なバックアップ）
  - [x] 手動保存ボタン
  - [ ] 保存データの確認・管理

- [x] **JSON エクスポート/インポート**
  - ドリルデータのJSON形式でのエクスポート
  - JSONファイルからの読み込み
  - バージョン管理（データ形式の互換性）

- [x] **YAML エクスポート/インポート**
  - ドリルデータのYAML形式でのエクスポート（人間が読みやすい形式）
  - YAMLファイルからの読み込み
  - コメント付きでエクスポート可能
  - JSONと同等の機能を持ちながら、より柔軟な編集が可能

- [x] **データベース連携**
  - [x] Prismaスキーマの完成（Drill、Set、Memberテーブル）
  - [x] API エンドポイント（保存・読み込み・一覧取得）
  - [x] ドリル一覧表示ページ
  - [x] **ユーザー認証（必須）**
    - [x] NextAuth.js (Auth.js) の導入
    - [x] ユーザーモデルの追加（Prismaスキーマ）
    - [x] ログイン/サインアップ機能
    - [x] セッション管理
    - [x] 認証ミドルウェア（API保護）
    - [x] ユーザーごとのドリル管理（データ分離）
    - [x] パスワード変更機能
    - [x] マイページ（プロフィール情報の表示・更新）
    - [x] ヘッダーにログイン名表示
    - [x] ログアウト機能
    - [x] パスワードリセット機能（メール経由、開発環境ではコンソールログ）
    - [ ] メール認証（オプション）

### 2. Undo/Redo の完全実装
**現状**: 履歴は記録されているが、復元機能が未実装。

**必要な機能**:
- [x] `useDrillSets` に `restoreState` 関数を実装
- [x] Undo/Redo実行時に状態を完全復元
- [ ] 履歴の上限設定（メモリ対策）
- [ ] 履歴の可視化（オプション）

### 3. セット間のコピー/ペースト
**現状**: セット追加時に現在のセットをコピーする機能はあるが、任意のセット間でのコピー/ペーストは未実装。

**必要な機能**:
- [x] セット全体のコピー
- [x] 選択メンバーのみコピー
- [ ] 複数セットへの一括ペースト
- [ ] クリップボード管理（複数のコピーを保持）

### 4. セットの削除・並び替え
**現状**: セットの追加のみ可能。

**必要な機能**:
- [x] セット削除機能
- [x] セットの並び替え（ドラッグ&ドロップ）
- [x] セット名の編集
- [ ] セットの複製

### 5. 設定ページの機能実装
**現状**: UIのみ。実際の設定変更は未実装。

**必要な機能**:
- [x] フィールドサイズの変更（リアルタイム反映）
- [x] 表示単位の切り替え（メートル/ヤード/ステップ）
- [x] グリッド表示のON/OFF
- [x] グリッド間隔の調整
- [x] BPM設定（再生速度に反映）

### 6. エラーハンドリング・バリデーション
**現状**: エラー処理が不十分。データの整合性チェックが未実装。

**必要な機能**:
- [x] **データバリデーション**
  - [x] インポート時のデータ形式チェック
  - [x] メンバーIDの重複チェック
  - [x] セットの開始カウントの重複チェック
  - [x] 座標の範囲チェック（フィールド外の値）

- [x] **エラーメッセージ表示**
  - [x] ユーザーフレンドリーなエラーメッセージ
  - [x] エラーの詳細情報表示（開発モード）
  - [x] エラー発生時の通知システム

- [ ] **データ復旧機能**
  - [ ] 破損データの自動修復
  - [ ] バックアップからの復元
  - [ ] データ整合性の自動チェック

### 7. バックアップ・復元機能
**現状**: 自動バックアップ機能が未実装。

**必要な機能**:
- [ ] **自動バックアップ**
  - 定期的な自動保存（設定可能な間隔）
  - 操作前の自動バックアップ
  - ブラウザ終了前の自動保存

- [ ] **バージョン履歴**
  - 過去のバージョン一覧表示
  - 特定バージョンへの復元
  - バージョン間の差分表示

- [ ] **復元ポイント**
  - 手動での復元ポイント作成
  - 復元ポイントへの名前付け
  - 復元ポイントの管理（削除・一覧表示）

### 8. 通知・フィードバック機能
**現状**: 操作の成功/失敗が視覚的に分かりにくい。

**必要な機能**:
- [ ] **操作通知**
  - 保存成功/失敗の通知
  - エクスポート/インポートの進捗表示
  - 操作の成功/失敗トースト通知

- [ ] **保存状態の表示**
  - 未保存の変更がある場合の警告表示
  - 自動保存の状態表示
  - 最後に保存した時刻の表示

- [ ] **進捗表示**
  - 大量データ処理時の進捗バー
  - 長時間処理のキャンセル機能

### 9. キーボードショートカット拡張
**現状**: Undo/Redo、Ctrl+Aのみ実装。

**必要な機能**:
- [x] **追加ショートカット**
  - [x] コピー/ペースト（Ctrl+C/Ctrl+V）
  - [x] 削除（Delete/Backspace）
  - [x] 全選択解除（Ctrl+D）
  - [x] セット切り替え（Ctrl+←/→）
  - [x] ズーム（Ctrl+Plus/Minus）
  - [x] グリッド表示切り替え（Ctrl+G）

- [x] **カスタマイズ可能なショートカット**
  - [x] ショートカット設定ページ
  - [x] ショートカットの競合チェック
  - [x] ショートカット一覧の表示

- [x] **ショートカットヘルプ**
  - [x] ショートカット一覧ダイアログ（?キー）
  - [x] コンテキストに応じたショートカット表示

### 10. ドラッグ&ドロップ機能
**現状**: ファイルのドラッグ&ドロップ読み込みが未実装。

**必要な機能**:
- [ ] **ファイルのドラッグ&ドロップ**
  - JSON/YAMLファイルのドロップ読み込み
  - 複数ファイルの一括読み込み
  - ドロップ時の視覚的フィードバック

- [ ] **メンバーの並び替え**
  - メンバーリストのドラッグ&ドロップ並び替え
  - セットリストのドラッグ&ドロップ並び替え

- [ ] **フィールド上へのドロップ**
  - メンバーをフィールド上に直接ドロップ配置
  - 複数メンバーの一括配置

---

## 優先度：中

### 11. 高度な整列機能
**現状**: 直線整列とベジェアークのみ。

**必要な機能**:
- [x] **円形整列**
  - [x] 中心点と半径の指定
  - [ ] 開始角度・終了角度の設定

- [x] **グリッド整列（ボックス整列）**
  - [x] 行数・列数の指定
  - [x] 間隔の調整

- [ ] **等間隔整列**
  - 選択メンバー間の距離を均等化

- [ ] **対称整列**
  - X軸/Y軸/中心点での対称配置

- [x] **矩形整列**
  - [x] 幅と高さの指定

- [x] **うずまき整列**
  - [x] 最大半径と回転数の指定

### 12. パス（移動経路）の可視化
**現状**: セット間の移動は再生時のみ表示。

**必要な機能**:
- [ ] 選択メンバーの移動経路を表示
- [ ] パスの編集（中間点の追加・削除）
- [ ] パスのスムージング設定
- [ ] 衝突検知の可視化

### 13. 検索・フィルタ機能
**必要な機能**:
- [x] メンバー名での検索
- [x] 楽器パートでのフィルタ
- [x] セット名での検索
- [x] カウント範囲でのフィルタ
- [x] 検索・フィルタパネル（サイドパネルに統合）

### 14. エクスポート機能
**必要な機能**:
- [x] **画像エクスポート**
  - [x] PNG/JPEG形式
  - [x] 解像度設定
  - [x] 背景色の選択

- [x] **PDFエクスポート**
  - [x] セットごとのページ分割
  - [x] グリッド線の表示/非表示
  - [x] メンバー情報の表示

- [x] **動画エクスポート**
  - [x] 再生アニメーションの録画（2D/3D）
  - [x] フレームレート設定
  - [x] 動画変換機能（MP4形式への変換）

### 15. パフォーマンス最適化
**必要な機能**:
- [ ] 大量メンバー時の描画最適化
- [ ] 仮想スクロール（メンバーリスト）
- [ ] メモ化の強化
- [ ] レンダリングの遅延読み込み

---

## 優先度：低

### 16. コメント・注釈機能
**必要な機能**:
- [ ] フィールド上へのテキスト注釈
- [ ] マーカー・矢印の追加
- [ ] セットごとの詳細メモ
- [ ] カウントごとのコメント

### 17. テンプレート機能
**必要な機能**:
- [ ] よく使うフォーメーションのテンプレート
- [ ] テンプレートの保存・読み込み
- [ ] テンプレートライブラリ

### 18. 統計・分析機能
**必要な機能**:
- [x] 移動距離の計算
- [x] 移動速度の分析
- [x] フォーメーションの複雑度スコア
- [x] 衝突リスクの可視化
- [x] 統計パネル（サイドパネルに統合）

### 19. マルチユーザー対応（将来）
**必要な機能**:
- [ ] リアルタイム共同編集
- [ ] 変更履歴の追跡
- [ ] コメント機能
- [ ] 権限管理

### 20. モバイル対応
**必要な機能**:
- [ ] タッチ操作の最適化
- [ ] レスポンシブレイアウトの改善
- [ ] モバイル用の簡易ビュー

---

### 21. ヘルプ・チュートリアル機能
**必要な機能**:
- [ ] **オンボーディング**
  - 初回起動時のチュートリアル
  - インタラクティブなガイド
  - スキップ可能なチュートリアル

- [ ] **ツールチップ・ヘルプ**
  - 各機能のツールチップ表示
  - コンテキストヘルプ（?ボタン）
  - 機能説明のポップアップ

- [ ] **ヘルプドキュメント**
  - 機能一覧ページ
  - よくある質問（FAQ）
  - 動画チュートリアルへのリンク

### 22. データ移行・インポート機能
**必要な機能**:
- [ ] **既存ツールからのインポート**
  - Pyware形式のインポート（将来的に）
  - CSV形式でのメンバー一覧インポート
  - 汎用的なデータ形式のサポート

- [ ] **データ形式の変換**
  - 異なるバージョン間のデータ変換
  - データ形式のアップグレード
  - 互換性チェック

- [ ] **一括インポート**
  - 複数ファイルの一括処理
  - インポート時のエラー報告
  - 部分的なインポート（エラーがあっても続行）

### 23. プリント機能
**必要な機能**:
- [ ] **印刷レイアウトの最適化**
  - 印刷用のレイアウトモード
  - ページ分割の自動調整
  - 印刷プレビュー機能

- [ ] **印刷オプション**
  - グリッド線の表示/非表示
  - メンバー情報の表示/非表示
  - セットごとのページ分割
  - カスタムヘッダー/フッター

- [ ] **複数ページ対応**
  - セットごとのページ分割
  - タイムラインの印刷
  - メンバー一覧の印刷

### 24. UIカスタマイズ機能
**必要な機能**:
- [ ] **テーマのカスタマイズ**
  - カラーテーマの選択（ダーク/ライト/カスタム）
  - アクセントカラーの変更
  - フォントサイズの調整

- [ ] **レイアウトのカスタマイズ**
  - サイドバーの表示/非表示
  - パネルの位置調整
  - ウィンドウサイズの記憶

- [ ] **表示設定**
  - グリッドの表示スタイル
  - メンバーの表示方法（ドット/アイコン/名前）
  - フィールド背景のカスタマイズ

### 25. テスト・品質保証
**必要な機能**:
- [ ] **ユニットテスト**
  - コア機能のユニットテスト
  - データ処理ロジックのテスト
  - 計算関数のテスト

- [ ] **E2Eテスト**
  - 主要なワークフローのE2Eテスト
  - ブラウザ互換性テスト
  - パフォーマンステスト

- [ ] **品質チェック**
  - コード品質の監視
  - パフォーマンスメトリクスの収集
  - エラートラッキング

---
- [ ] 音楽ファイルの読み込み
- [ ] 音楽に合わせたカウント表示
- [ ] 音楽再生とドリルの同期

### 27. 3D編集機能
- [ ] 3D空間での編集
- [ ] 高さ（Z軸）の設定
- [ ] 3Dプレビューの改善

### 28. AI支援機能
- [ ] 自動パス生成
- [ ] 衝突回避の提案
- [ ] フォーメーションの最適化提案

### 29. プラグインシステム
- [ ] カスタム整列アルゴリズム
- [ ] 外部ツールとの連携
- [ ] 拡張機能のAPI

### 30. 多言語対応
- [ ] 英語・日本語の切り替え
- [ ] その他の言語への拡張

---

## 🎨 面白い機能のアイデア

### 31. フォーメーション自動生成・提案機能
**コンセプト**: AIやアルゴリズムを使って、指定した条件から最適なフォーメーションを自動生成

**必要な機能**:
- [ ] **条件指定による自動生成**
  - メンバー数・パート構成から最適な配置を提案
  - 指定した形状（円形、直線、V字など）への自動配置
  - 対称性を考慮した配置の自動生成
  - 移動距離を最小化する配置の提案

- [ ] **フォーメーションライブラリ**
  - よく使われるフォーメーションのテンプレート集
  - ユーザーが作成したフォーメーションの共有
  - カテゴリ別検索（開幕、フィナーレ、トランジションなど）

- [ ] **スマートなトランジション提案**
  - 現在のフォーメーションから次のフォーメーションへの最適な移動経路を提案
  - 衝突を避けた自動パス生成
  - 移動距離・時間を考慮した最適化

### 32. リハーサル・練習モード
**コンセプト**: 実際の練習をシミュレートして、問題点を事前に発見

**必要な機能**:
- [ ] **リハーサルシミュレーション**
  - 実際の練習速度での再生（通常より遅い速度）
  - セクションごとの繰り返し練習
  - 特定メンバーにフォーカスした再生

- [ ] **問題点の自動検出**
  - 衝突リスクの警告
  - 移動距離が長すぎるメンバーの検出
  - 移動速度が速すぎる箇所の検出
  - フォーメーションのバランスチェック

- [ ] **練習記録機能**
  - リハーサルでのメモ機能
  - 問題箇所へのマーカー付け
  - 改善提案の記録

### 33. パフォーマンス分析・統計ダッシュボード
**コンセプト**: ドリルのパフォーマンスを数値化して可視化

**必要な機能**:
- [ ] **移動距離・速度の分析**
  - 各メンバーの総移動距離
  - セットごとの平均移動速度
  - 移動距離の分布グラフ
  - 最も移動が多いメンバーの特定

- [ ] **フォーメーションの複雑度スコア**
  - フォーメーションの難易度を数値化
  - セット間の変化量の可視化
  - 練習時間の目安を自動計算

- [ ] **視覚的インパクト分析**
  - フォーメーションの視覚的効果をスコア化
  - 対称性・バランスの評価
  - 観客からの見えやすさの評価

### 34. コラボレーション・共同編集機能
**コンセプト**: 複数人で同時にドリルを編集できる

**必要な機能**:
- [ ] **リアルタイム共同編集**
  - WebSocketを使ったリアルタイム同期
  - 複数ユーザーのカーソル表示
  - 同時編集の競合解決

- [ ] **コメント・レビュー機能**
  - フィールド上へのコメント追加
  - セットごとのレビューコメント
  - @メンション機能

- [ ] **変更履歴・バージョン管理**
  - 誰がいつ何を変更したかの記録
  - 特定の変更の取り消し
  - 変更履歴の可視化

### 35. テンプレートマーケットプレイス
**コンセプト**: ユーザーが作成したフォーメーションを共有・販売できる

**必要な機能**:
- [ ] **テンプレートの共有**
  - フォーメーションの公開/非公開設定
  - カテゴリ・タグ付け
  - 評価・レビュー機能

- [ ] **テンプレートの検索・フィルタ**
  - メンバー数・パート構成での検索
  - 人気順・新着順での並び替え
  - お気に入り機能

- [ ] **テンプレートのカスタマイズ**
  - ダウンロードしたテンプレートの編集
  - 自分のメンバー構成に合わせた自動調整

### 36. 動画エクスポート・SNS共有機能
**コンセプト**: 作成したドリルを動画として出力してSNSで共有

**必要な機能**:
- [ ] **高品質動画エクスポート**
  - 4K/1080p対応
  - カスタムフレームレート設定
  - 背景音楽の追加
  - タイトル・クレジットの追加

- [ ] **SNS最適化**
  - Instagram/TikTok用の縦型動画
  - Twitter用の短縮動画
  - YouTube用の長尺動画
  - 自動サムネイル生成

- [ ] **ワンクリック共有**
  - 動画生成後の直接アップロード
  - 共有リンクの生成
  - QRコード生成

### 37. AR/VRプレビュー機能
**コンセプト**: 実際のフィールド上でARとしてドリルを表示

**必要な機能**:
- [ ] **ARプレビュー**
  - スマホカメラで実際のフィールドにドリルを重ねて表示
  - メンバーの位置をARマーカーで表示
  - 移動経路の可視化

- [ ] **VR体験**
  - VRヘッドセットでの3D体験
  - メンバーの視点からの体験
  - 観客席からの視点

### 38. 音楽同期の高度化
**コンセプト**: 音楽とドリルを完全に同期させた体験

**必要な機能**:
- [ ] **音楽ファイルの直接編集**
  - 音楽ファイルのアップロード
  - カウントと音楽のタイミング調整
  - 音楽の速度変更（BPM調整）

- [ ] **マーカー・シンクポイント**
  - 音楽の重要なポイントにマーカーを設定
  - マーカーに合わせたフォーメーション変更
  - 自動シンク機能

- [ ] **複数トラック対応**
  - メイン音楽とドラムトラックの分離
  - パートごとの音楽トラック
  - 音量バランスの調整

### 39. ゲーム化・アチーブメント機能
**コンセプト**: ドリル作成を楽しくするゲーム要素

**必要な機能**:
- [ ] **バッジ・アチーブメント**
  - 「100個のセットを作成」などの実績
  - 特別なフォーメーション作成のバッジ
  - 連続ログインボーナス

- [ ] **スキルレベルシステム**
  - ドリル作成の経験値
  - レベルアップによる機能解放
  - スキルツリー

- [ ] **チャレンジモード**
  - 制限時間内でのフォーメーション作成
  - 指定条件での最適化チャレンジ
  - ランキング機能

### 40. フォーメーション最適化エンジン
**コンセプト**: 指定した条件から最適なフォーメーションを自動生成

**必要な機能**:
- [ ] **制約条件の設定**
  - 移動距離の上限
  - 移動速度の上限
  - 衝突回避の必須化
  - 対称性の要求

- [ ] **最適化アルゴリズム**
  - 遺伝的アルゴリズムによる最適化
  - シミュレーテッドアニーリング
  - 複数の最適解の提案

- [ ] **最適化結果の比較**
  - 複数の最適化案の並列表示
  - 各案の評価スコア表示
  - 最適案の自動選択

### 41. 音声ガイダンス機能
**コンセプト**: 音声でドリルを案内する機能

**必要な機能**:
- [ ] **音声ナビゲーション**
  - 「次のセットに移動します」などの音声案内
  - メンバー名の音声読み上げ
  - カウントの音声読み上げ

- [ ] **多言語音声対応**
  - 日本語・英語の音声
  - カスタム音声のアップロード
  - TTS（Text-to-Speech）機能

### 42. 練習計画・スケジュール管理
**コンセプト**: ドリルの練習スケジュールを管理

**必要な機能**:
- [ ] **練習スケジュール**
  - セットごとの練習予定日
  - 練習時間の記録
  - 進捗状況の可視化

- [ ] **練習メモ**
  - セットごとの練習メモ
  - 問題点の記録
  - 改善点の記録

### 43. 競技会モード
**コンセプト**: 競技会用の特別な機能

**必要な機能**:
- [ ] **競技会フォーマット**
  - 競技会のルールに合わせたフォーマット
  - 時間制限の設定
  - 採点項目の設定

- [ ] **審査員向けビュー**
  - 審査員用の特別な表示モード
  - 採点用のインターフェース
  - 評価項目の記録

### 44. データ可視化・分析レポート
**コンセプト**: ドリルのデータを詳細に分析

**必要な機能**:
- [ ] **詳細レポート生成**
  - PDF形式でのレポート出力
  - グラフ・チャートの自動生成
  - 統計情報の可視化

- [ ] **比較機能**
  - 複数のドリルバージョンの比較
  - 変更点のハイライト
  - 改善度の数値化

---

## 実装の優先順位（推奨）

### Phase 1: データ永続化（最優先）
1. ✅ ローカルストレージ保存
2. ✅ JSON エクスポート/インポート
3. ✅ Undo/Redo の完全実装
4. ✅ **ユーザー認証（サービス公開前に必須）**

### Phase 2: 基本機能の完成
4. セット間のコピー/ペースト
5. セットの削除・並び替え
6. 設定ページの機能実装
7. エラーハンドリング・バリデーション
8. バックアップ・復元機能
9. 通知・フィードバック機能

### Phase 3: ユーザビリティ向上
10. キーボードショートカット拡張
11. ドラッグ&ドロップ機能
12. ヘルプ・チュートリアル機能
13. UIカスタマイズ機能

### Phase 4: 高度な機能
14. 高度な整列機能
15. パスの可視化
16. エクスポート機能
17. 検索・フィルタ機能

### Phase 5: 追加機能
18. コメント・注釈機能
19. テンプレート機能
20. データ移行・インポート機能
21. プリント機能
22. 統計・分析機能

---

## 技術的な考慮事項

### データ構造
- `Drill` 型の拡張（メタデータ、バージョン情報）
- セット間の関係性の管理
- 履歴データの圧縮

### パフォーマンス
- 大量データ時の処理最適化
- 描画の最適化（Canvas/WebGL）
- メモリ管理

### セキュリティ
- データの検証
- XSS対策
- ファイルアップロードの安全性

### アクセシビリティ
- キーボード操作の完全対応
- スクリーンリーダー対応
- 色覚対応

---

## 参考資料

- Pyware（既存のドリルデザインツール）
- マーチングバンドの標準的なワークフロー
- ユーザーフィードバック（今後収集）


